<part id="installation">
<title>Installation</title>
	<chapter id="requirements">
		<title>Requirements</title>
		<para>Cacti requires that the following software is installed on your system.</para>
		<itemizedlist>
			<listitem>
				<para>
					<application>RRDTool</application> 1.0.49 or 1.2.x or greater
				</para>
			</listitem>
			<listitem>
				<para>
					<application>MySQL</application> 4.1.x or 5.x or greater
				</para>
			</listitem>
			<listitem>
				<para>
					<application>PHP</application> 4.3.6 or greater, 5.x greater highly recommended for advanced features
				</para>
			</listitem>
			<listitem>
				<para>
					<application>A Web Server</application> e.g. Apache or IIS
				</para>
			</listitem>
		</itemizedlist>
	</chapter>
	<chapter id="install_unix">
		<title>Installing Under Unix</title>
			<para>
				Please make sure, the following packages are installed
				according to your operating systems requirements. Verify,
				that <application>httpd</application> and
				<application>mysqld</application> are started at system
				startup.
			</para>
			<sect1 id="rpm_packages">
				<title>Required Packages for RPM-based Operating Systems</title>
				<itemizedlist>
					<listitem>
						<para>
							<filename>httpd</filename>
						</para>
					</listitem>
					<listitem>
						<para>
							<filename>php</filename>
						</para>
					</listitem>
					<listitem>
						<para>
							<filename>php-mysql</filename>
						</para>
					</listitem>
					<listitem>
						<para>
							<filename>php-snmp</filename>
						</para>
					</listitem>
					<listitem>
						<para>
							<filename>mysql</filename>
						</para>
					</listitem>
					<listitem>
						<para>
							<filename>mysql-server</filename>
						</para>
					</listitem>
					<listitem>
						<para>
							<filename>net-snmp</filename>
						</para>
					</listitem>
				</itemizedlist>
			</sect1>
			<sect1 id="bsd_ports">
				<title>Ports for FreeBSD</title>
				<itemizedlist>
					<listitem>
						<para>
							<filename>www/apache2</filename>
						</para>
					</listitem>
					<listitem>
						<para>
							<filename>net/rrdtool</filename>
						</para>
					</listitem>
					<listitem>
						<para>
							<filename>net/net-snmp</filename>
						</para>
					</listitem>
					<listitem>
						<para>
							<filename>www/php4-cgi</filename>
						</para>
					</listitem>
					<listitem>
						<para>
							<filename>lang/php4</filename> (With <application>MySQL</application> and SNMP Support)
						</para>
					</listitem>
					<listitem>
						<para>
							<filename>databases/mysql323-server</filename>
						</para>
					</listitem>
				</itemizedlist>
			</sect1>
			<sect1 id="unix_configure_php">
				<title>Configure PHP</title>
					<para>
						Please find the file <filename>/etc/php.ini</filename>
						and make the following changes to it:
					</para>
					<screen><userinput>extension_dir = /etc/php.d</userinput></screen>
					<para>
						This will enable PHP to find more configuration directives in that very directory. Other distros point to <filename>/usr/lib/php/modules</filename> instead. In each case, you should locate e.g. <filename>mysql.so</filename> in that directory.
					</para>
					<para>
						Activate the <application>MySQL</application> extension
						via /etc/php.d/mysql.ini
					</para>
					<screen><userinput>; Enable mysql extension module
extension=mysql.so</userinput></screen>
					<para>
						Activate the <application>SNMP</application> extension
						via /etc/php.d/snmp.ini
					</para>
					<screen><userinput>; Enable snmp extension module
extension=snmp.so</userinput></screen>
					<para>
						If using PHP 4.3.5 or less include the following line.  If using 4.3.6 or greater, you should remove this line if present.
					</para>
					<screen><userinput>session.save_path=/tmp</userinput></screen>
					<para>
						If you want to allow template importing, uncomment the following line:
					</para>
					<screen><userinput>file_uploads = On</userinput></screen>
			</sect1>
			<sect1 id="unix_configure_httpd">
				<title>Configure the Webserver (Apache)</title>
					<para>
						If you are using <emphasis>Apache 1.3.x</emphasis>,
						installation of PHP 5 is not recommended.
					</para>
					<para>
						Please find the file <filename>/etc/httpd/conf/httpd.conf</filename>
						or equivalent and make the following changes to it:
					</para>
					<screen><userinput># Load config files from the config directory "/etc/httpd/conf.d".
Include conf.d/*.conf</userinput></screen>
					<para>
						Now, please locate the PHP configuration file at
						<filename>/etc/httpd/conf.d/php.conf</filename>
					</para>
					<para>
						If using PHP 5, then add the following lines.
					</para>
					<screen><userinput># PHP is an HTML-embedded scripting language which attempts to make it
# easy for developers to write dynamically generated webpages.
LoadModule php5_module modules/libphp5.so
#
# Cause the PHP interpreter to handle files with a .php extension.
AddHandler php5-script .php
AddType text/html .php
#
# Add index.php to the list of files that will be served as directory
# indexes.
DirectoryIndex index.php</userinput></screen>
					<para>If you decide to not install cacti to a subdirectory of <parameter>DocumentRoot</parameter>,
					please add a new Apache configuration file in <filename>/etc/http/conf.d/cacti</filename> that holds</para>
					<screen><userinput>Alias /cacti  "/full/path/to/cacti/"
&lt;Directory "/full/path/to/cacti/"&gt;
    Options Indexes FollowSymLinks Includes MultiViews
    Order allow,deny
    Allow from all
&lt;/Directory&gt;</userinput></screen>
					<para>Where <filename>/full/path/to/cacti/</filename> is the name of the directory,
					were <application>cacti</application> was installed. The, please restart Apache via</para>
					<screen><prompt>shell &gt;</prompt> <userinput>/etc/init.d/httpd restart</userinput></screen>
			</sect1>
			<sect1 id="unix_configure_mysql">
				<title>Configure MySQL</title>
					<para>
						Set a password for the root user
					</para>
<screen><prompt>shell&gt;</prompt> <userinput>mysqladmin --user=root password somepassword</userinput>
<prompt>shell&gt;</prompt> <userinput>mysqladmin --user=root --password reload</userinput></screen>
			</sect1>
			<sect1 id="unix_configure_cacti">
				<title>Install and Configure Cacti</title>
				<orderedlist>
					<listitem>
						<para>Extract the distribution tarball.</para>
						<screen><prompt>shell&gt;</prompt> <userinput>tar xzvf cacti-version.tar.gz</userinput></screen>
					</listitem>
					<listitem>
						<para>Create the MySQL database:</para>
						<screen><prompt>shell&gt;</prompt> <userinput>mysqladmin --user=root create cacti</userinput></screen>
					</listitem>
					<listitem>
						<para>Import the default cacti database:</para>
						<screen><prompt>shell&gt;</prompt> <userinput>mysql cacti &lt; cacti.sql</userinput></screen>
					</listitem>
					<listitem>
						<para>
							Optional: Create a MySQL username and password for Cacti.
						</para>
						<screen><prompt>shell&gt;</prompt> <userinput>mysql --user=root mysql</userinput>
<prompt>mysql&gt;</prompt> <userinput>GRANT ALL ON cacti.* TO cactiuser@localhost IDENTIFIED BY 'somepassword';</userinput>
<prompt>mysql&gt;</prompt> <userinput>flush privileges;</userinput></screen>
					</listitem>
					<listitem>
						<para>
							Edit <filename>include/config.php</filename> and specify the database type, name, host, user and password for your Cacti configuration.
						</para>
						<screen><userinput>$database_type = "mysql";
$database_default = "cacti";
$database_hostname = "localhost";
$database_username = "cactiuser";
$database_password = "cacti";</userinput></screen>
					</listitem>
					<listitem>
						<para>
							Set the appropriate permissions on cacti's directories for graph/log generation. You
							should execute these commands from inside cacti's directory to change the permissions.
						</para>
						<screen><prompt>shell&gt;</prompt> <userinput>chown -R cactiuser rra/ log/</userinput></screen>
						<para>
							(Enter a valid username for <emphasis>cactiuser</emphasis>, this user will also be used in the next step for
							data gathering.)
						</para>
					</listitem>
					<listitem>
						<para>
							Add a line to your <filename>/etc/crontab</filename> file similar to:
						</para>
						<screen>*/5 * * * * cactiuser php /var/www/html/cacti/poller.php &gt; /dev/null 2&gt;&amp;1</screen>
						<simpara>
							Replace <emphasis>cactiuser</emphasis> with the valid user specified in the previous step.
						</simpara>
						<simpara>
							Replace <filename>/var/www/html/cacti/</filename> with your full Cacti path.
						</simpara>
					</listitem>
					<listitem>
						<para>
							Point your web browser to:
						</para>
						<blockquote>
							<para>
								http://your-server/cacti/
							</para>
						</blockquote>
						<para>
							Log in the with a username/password of <emphasis>admin</emphasis>. You will be required to change this
							password immediately. Make sure to fill in all of the path variables carefully and
							correctly on the following screen.
						</para>
					</listitem>
				</orderedlist>
			</sect1>
			<sect1 id="unix_configure_spine">
				<title>(Optional) Install and Configure <application>Spine</application></title>
				<para>
					<application>Spine</application> is a very fast poller engine, written in C.
					It is an optional replacement for cmd.php. If you decide
					to use it, you will have to install it explicitely. It
					does not come with cacti itself.
				</para>
				<para>
					The easiest way is to install <application>Spine</application> using rpm or ports.
					You will find packages for <application>Spine</application> at the main cacti site
					or from your distribution.
				</para>
				<para>To compile <application>Spine</application>, please download
				it to any location of your liking. Then, please issue from the downloaded
				directory following commands</para>
				<screen><prompt>shell&gt;</prompt>aclocal</screen>
				<screen><prompt>shell&gt;</prompt>libtoolize --force  (glibtoolize --force on Max OS)</screen>
				<screen><prompt>shell&gt;</prompt>autoheader</screen>
				<screen><prompt>shell&gt;</prompt>autoconf</screen>
				<screen><prompt>shell&gt;</prompt>automake</screen>
				<screen><prompt>shell&gt;</prompt>./configure</screen>
				<screen><prompt>shell&gt;</prompt>make</screen>
				<screen><prompt>shell&gt;</prompt>make install</screen>
				<para>
					Assuming, you've managed to install <application>Spine</application> correctly,
					you will have to configure it. The configuration file
					may be placed in the same directory as <application>Spine</application> itself or
					at /etc/<application>Spine</application>.conf.
				</para>
				<screen><userinput>DB_Host	127.0.0.1 or hostname (not localhost)
DB_Database	cacti
DB_User		cactiuser
DB_Password	cacti
DB_Port		3306</userinput></screen>
				<para>
					All other pre 0.8.6 settings are obsolete.
				</para>
			</sect1>
			<sect1 id="unix_apply_patches">
				<title>Apply Patches</title>
					<para>
						Please visit the Cacti website at http://www.cacti.net/download_patches.php
						If any patch has been released, you will find installation
						instructions there.
					</para>
					<para>
						As an example, please find patch installation instructions
						for cacti 0.8.6j here.
						Do not apply those patches to recent releases!
					</para>
				<screen><userinput>wget http://www.cacti.net/downloads/patches/0.8.6j/ping_php_version4_snmpgetnext.patch
wget http://www.cacti.net/downloads/patches/0.8.6j/tree_console_missing_hosts.patch
wget http://www.cacti.net/downloads/patches/0.8.6j/thumbnail_graphs_not_working.patch
wget http://www.cacti.net/downloads/patches/0.8.6j/graph_debug_lockup_fix.patch
wget http://www.cacti.net/downloads/patches/0.8.6j/snmpwalk_fix.patch
patch -p1 -N < ping_php_version4_snmpgetnext.patch
patch -p1 -N < tree_console_missing_hosts.patch
patch -p1 -N < thumbnail_graphs_not_working.patch
patch -p1 -N < graph_debug_lockup_fix.patch
patch -p1 -N < snmpwalk_fix.patch</userinput></screen>
					<para>
						You might need to reapply file/folder security
						on the files patched. Double check they are correct.
					</para>
					<para>Please pay attention not to break cacti when using SELinux or using NTFS file security.
					If you encounter</para><para><computeroutput>PHP Warning:  include_once(./lib/html_tree.php) [&lt;a href='function.include-once'&gt;function.include-once&lt;/a&gt;]: failed to open stream: Permission denied in /var/www/cacti/graphs.php on line 33, referer: http://localhost/cacti/graphs.php </computeroutput></para>
					<para>or the like, it is very likely that your permissions are wrong.</para>
			</sect1>
	</chapter>
	<chapter id="install_windows">
<title>Installing Under Windows</title>
	<sect1 id="windows_downloads"><title>Downloads</title>
		<para>Required downloads:</para>
		<orderedlist>
			<listitem><para><ulink url="http://www.cacti.net/download_cacti.php">Cacti</ulink></para>
<para>Latest version available.</para></listitem>

			<listitem><para><ulink url="http://www.cacti.net/downloads/rrdtool/win32/">RRDTool</ulink>.</para> 
<para>Minimum version: <emphasis>1.0</emphasis>. Recommended: <emphasis>1.2.15</emphasis></para>
<Note><para>Cygwin build for versions before 1.2.15 are required. Win32 build 
should work fine after 1.2.15.</para></Note></listitem>
	
			<listitem><para><ulink url="http://www.php.net/downloads.php">PHP</ulink>.</para>
<para>Minimum: <emphasis>4.3.6</emphasis>. Recommended: <emphasis>5.2</emphasis></para>
<para>Download the installer and zip package.</para></listitem>

			<listitem><para><ulink url="http://dev.mysql.com/downloads/mysql/5.0.html">MySQL</ulink>.</para>
<para>Minimum: <emphasis>4.1</emphasis>. Recommended: <emphasis>5.0</emphasis>.</para>
<para>Download the larger	ZIP/Setup.exe file, NOT Windows Essentials.</para>
<Note><para>MySQL 5 is only supported in Cacti 0.8.6i or later.</para></Note></listitem>
		</orderedlist>
		
		<para>Optional downloads:</para>
		<orderedlist>
			<listitem><para><ulink url="http://www.cacti.net/spine_download.php">Spine</ulink>.</para>
<para>Latest version available.</para></listitem>

			<listitem><para><ulink url="http://www.cygwin.com/">Cygwin</ulink>.</para>
<para>Recommended: <emphasis>1.5</emphasis>.</para>
<para>Download <filename>setup.exe</filename>.</para></listitem>

			<listitem><para><ulink url="http://httpd.apache.org/download.cgi">Apache</ulink>.</para>
<para>Minimum	version: <emphasis>2.0</emphasis>. Recommended version: <emphasis>2.2</emphasis>.</para>
<para>Download the MSI installer.</para></listitem>

			<listitem><para><ulink url="http://net-snmp.sourceforge.net/download.html">Net-SNMP</ulink>.</para> 
<para>Minimum: <emphasis>5.3.1</emphasis>. Recommended: <emphasis>5.4</emphasis>.</para>
<para>ownload the Win32 installer.</para></listitem>

			<listitem><para><ulink url="Cacti-Security.zip">Cacti-Security</ulink></para>
<para>A script to configure NTFS permissions automatically for you.</para>
<para><ulink url="http://www.microsoft.com/windows2000/techinfo/reskit/tools/existing/xcacls-o.asp">Xcacls</ulink> will be needed.</para></listitem>
		</orderedlist>
	</sect1>


	<sect1 id="windows_installation"><title>Installation</title>
		<para>Log on as an Administrator and install the following pieces of software.</para>
		<para><emphasis>Cacti</emphasis></para>
		<para><emphasis>Recommended Install Path:</emphasis><filename>C:\Inetpub\wwwroot\cacti\</filename></para>

		<itemizedlist>
			<listitem><para>Extract the cacti zip file to the root of your web server directory. This will be 
			<filename>c:\inetpub\wwwroot</filename> if you are using the default installation of IIS. The extracted directory will be called 
			<emphasis>cacti-0.8.6j</emphasis>. Rename it to <emphasis>cacti</emphasis>. </para></listitem>
		</itemizedlist>

		<para><emphasis>PHP</emphasis></para>
		<para><emphasis>Recommended Install Path:</emphasis> <filename>C:\PHP\</filename></para>
		<Note><para>Do not install into a path containing spaces (i.e. <filename>C:\Program Files\PHP\</filename>) unless you're prepared to deal with 8.3 filenames.</para></Note>

		<itemizedlist>
			<listitem><para>Double-click on the php installer to start it running.</para>
			<orderedlist numeration=lowerroman>
				<listitem><para>Click <emphasis>Next</emphasis> to the welcome page.</para></listitem>
				<listitem><para>Click <emphasis>I Agree</emphasis> to accept the license agreement.</para></listitem>
				<listitem><para>At the Destination Folder page, change the path to:
				<filename>C:\PHP\</filename> and click <emphasis>Next</emphasis>.</para></listitem>
				<listitem><para>At the Web Server page, select <emphasis>IIS ISAPI Module</emphasis> 
				and click <emphasis>Next</emphasis>.</para></listitem>
				<listitem><para>At the Choose Item page, do the following:</para>
				<orderedlist numeration=lowerroman>
					<listitem><para>Click on the Program folder and select <emphasis>entire 
					feature will be installed on local hard drive</emphasis>. The icon 
					should now be white.</para></listitem>
					<listitem><para>Under the Extension folder, select <emphasis>MySQL</emphasis>,
					<emphasis>SNMP</emphasis>, and <emphasis>Sockets</emphasis> to be 
					installed.</para></listitem>
				</orderedlist></listitem>
				<listitem><para>Click <emphasis>Next</emphasis>.</para></listitem>
				<listitem><para>Click <emphasis>Install</emphasis>.</para></listitem>
				<listitem><para>Once done installing, click <emphasis>Finish</emphasis>.</para></listitem>
			</orderedlist></listitem>
			<listitem><para>Create new folders under <filename>C:\PHP\</filename> called
			<emphasis>Uploadtemp</emphasis> and <emphasis>Session</emphasis>.</para></listitem>
			<listitem><para>Extract the contents of the PHP zip file</para>
			<orderedlist>
				<listitem><para>Move the \extras\mibs\ folder to <filename>C:\PHP\Extras\</filename></para></listitem>
			</orderedlist></listitem>
		</itemizedlist>

		<para><emphasis>MySQL</emphasis></para>
		<para><emphasis>Recommended Install Path:</emphasis> <filename>C:\MySQL\</filename></para>
		<itemizedlist>
			<listitem><para>Extract the MySQL zip file to a temporary directory (e.g. C:\Temp) and run the
			<filename>Setup.exe</filename> file.</para> 
			<orderedlist numeration=lowerroman>
				<listitem><para>At the Welcome screen, click <emphasis>Next</emphasis>.</para></listitem>
				<listitem><para>At the Setup Type screen, select <emphasis>Custom</emphasis> and click 
				<emphasis>Next</emphasis>.</para></listitem>
				<listitem><para>At the Custom Setup screen for component selection, leave the 
				defaults. </para></listitem>
				<listitem><para>At the bottom of the page, click on <emphasis>Change...</emphasis> and alter the destination 
				folder to be <filename>C:\MySQL\</filename> and click <emphasis>OK</emphasis>.</para></listitem>
				<listitem><para>Click on <emphasis>Next</emphasis>.</para></listitem>
				<listitem><para>Click <emphasis>Install</emphasis> to proceed with the installation.</para></listitem>
				<listitem><para>Close the MySQL Enterprise screen.</para></listitem>
				<listitem><para>At the Wizard Completed screen, leave <emphasis>Configure MySQL Server now</emphasis> 
				checked and click <emphasis>Finish</emphasis>.</para></listitem>
			</orderedlist></listitem>
			<listitem><para>MySQL Service Instance Configuration Wizard</para>
			<orderedlist numeration=lowerroman>
				<listitem><para>At the Welcome screen, click <emphasis>Next</emphasis>.</para></listitem>
				<listitem><para>At the MySQL Service Instance Configuration screen, select <emphasis>Detailed Configuration</emphasis> and click 
				<emphasis>Next</emphasis>.</para></listitem>
				<listitem><para>At the server type screen, select <emphasis>Server Machine</emphasis> and click 
				<emphasis>Next</emphasis>.</para></listitem>
				<listitem><para>At the database usage screen, select <emphasis>Non-Transactional Database Only</emphasis> and click 
				<emphasis>Next</emphasis>.</para></listitem>
				<listitem><para>At the concurrent connection screen, select <emphasis>Decision Support OLAP</emphasis> and click 
				<emphasis>Next</emphasis>.</para></listitem>
				<listitem><para>At the networking options page, check <emphasis>Enabled TCP/IP 
				networking</emphasis> and leave default port 3306. <emphasis>Uncheck</emphasis></para></listitem>
				<listitem><para><emphasis>Enable Strict Mode</emphasis>. Click <emphasis>Next</emphasis>.</para></listitem>
				<listitem><para>At the default character set page, select <emphasis>Standard Character Set</emphasis> and click
				<emphasis>Next</emphasis>. </para></listitem>
				<listitem><para>At the Windows options page, check <emphasis>Install as Windows 
				Service</emphasis> and <emphasis>Include Bin Directory in Windows PATH</emphasis>. Click 
				<emphasis>Next</emphasis>.</para></listitem>
				<listitem><para>At the security options page, type in a root password. Click 
				<emphasis>Next</emphasis>.</para></listitem>
				<listitem><para>At the Ready to execute page, click on <emphasis>Execute</emphasis>.</para></listitem>
				<listitem><para>Click on <emphasis>Finish</emphasis>.</para></listitem>
			</orderedlist></listitem>
		</itemizedlist>
	
		<para><emphasis>RRDTool</emphasis></para>
		<para><emphasis>Recommended Install Path:</emphasis> <filename>C:\RRDTool\</filename></para>
	
		<itemizedlist>
			<listitem><para>Extract the rrdtool zip file to <filename>C:\RRDTool\.</filename></para></listitem>
		</itemizedlist>
	
	
		<para>Now at this point you have enough installed to configure and test before adding further complication 
		and problems. Continue on to the <ulink url="windows_patching.html">patching</ulink> section.</para>
	</sect1>


	<sect1 id="windows_installation_optional"><title>Installations - Optional Components</title>
		<para>These various components are not required for Cacti to function. Some 
		are a choice of preference or performance.</para>

		<para><emphasis>Spine</emphasis>
		Recommended Install Path: <filename>C:\Spine\</filename>
		<emphasis>Information:</emphasis> Spine is a poller for Cacti that primarily 
		strives to be as fast as possible. For this reason it is written in native C, 
		makes use of POSIX threads, and is linked directly against the net-snmp library 
		for minimal SNMP polling overhead. Spine is a replacement for the default 
		cmd.php poller so you must decide if using Spine makes sense for your 
		installation. It is highly recommended that users start out with the 
		default cmd.php poller until their installation is fully functional! 
		Cactid was renamed to Spine for the 0.8.7 release.</para>

		<para>Cactid is for Cacti 0.8.6 and below. Spine is for Cacti 0.8.7 and above.</para>

		<itemizedlist>
			<listitem><para>Extract the spine zip file to C:\Spine\</para></listitem>
		</itemizedlist>
		<Warning><para> Spine is only compiled with Cygwin and thusly needs a few Cygwin dlls on the system. These are 
		included with the downloaded zip file. This can become a problem if 
		RRDTool is also compiled under a different Cygwin version, since then there will 
		be different Cygwin dll versions on the system which can cause issues. If 
		you&#39;re using a Win32 build of RRDTool, then nothing to worry about.</para></Warning>
		
		<para>There are a few ways to solve the problem: </para>

		<orderedlist>
			<listitem><para>Install a base install of Cygwin and delete all cygwin files from the 
			RRDTool and Spine folders.</para></listitem>
			<listitem><para>Move RRDTool and Spine into the same folder, so they share the Cygwin 
			dlls. Your mileage may vary due to each binary being compiled against 
			a different Cygwin version.</para></listitem>
		</orderedlist>
		
		<para><emphasis>Cygwin</emphasis></para>
		<para>Recommended Install Path:<filename>C:\Cygwin\</filename></para>
		
		<para><emphasis>Information:</emphasis> Cygwin is a Linux-like environment for Windows. 
		The benefit of having Cygwin installed is so there that there are only one 
		set of Cygwin dlls on the system. Both RRDTool and Spine come with 
		cygwin dlls and can cause version conflicts. If you plan on compiling 
		RRDTool or Spine, Cygwin is required.</para>
		<orderedlist>
			<listitem><para>Run <filename>setup.exe.</filename></para></listitem>
			<listitem><para>Once you reach the portion of setup entitled <guilabel>Select Packages</guilabel>, 
			install the following:
			<screen>Base (whole thing)
Libs
libart_lgpl
libfreetype26
libintl3
libpng12
readline
zlib
Utils
patch
Web
wget</screen></para></listitem>
			<listitem><para>Add <filename>c:\cygwin\bin</filename> to your system path.</para></listitem>
			<listitem><para>Move <filename>setup.exe</filename> to <filename>c:\cygwin</filename> for future use.</para></listitem>
		</orderedlist>

		<para><emphasis>Apache</emphasis>
		<emphasis>Recommended Install Path:</emphasis> <filename>C:\Apache2\</filename></para>
		<Note><para>Do not install into a path containing spaces (i.e. 
		C:\Program Files\Apache\) unless you're prepared to deal with 8.3 filenames.</para></Note>
		<Note><para>Using Apache instead of IIS is purely preferential 
		as Cacti works with either.</para></Note>
		<itemizedlist>
			<listitem><para>If planning on using Apache, it should be installed before installing PHP.</para></listitem>
			<listitem><para>Make sure you have stopped all IIS services before you proceed with the Apache installation.</para></listitem>
			<listitem><para>Run the apache setup msi file
				<orderedlist>
					<listitem><para>At the Welcome screen, click <emphasis>Next</emphasis>.</para></listitem>
					<listitem><para>At the license agreement screen, select <emphasis>I Accept</emphasis> 
					and click <emphasis>Next</emphasis>.</para></listitem>
					<listitem><para>At the Read this first page, click <emphasis>Next</emphasis>.</para></listitem>
					<listitem><para>At the Server Information page, enter in the network domain, server 
					name and email (if applicable) and click <emphasis>Next</emphasis>.</para></listitem>
					<listitem><para>At the Setup type page, select <emphasis>Typical</emphasis> and click
					<emphasis>Next</emphasis>.</para></listitem>
					<listitem><para>At the Destination folder page, click on <emphasis>Change...</emphasis>. 
					Change the folder name to <filename>C:\Apache2\</filename>. Click
					<emphasis>OK</emphasis> and then <emphasis>Next</emphasis>.</para></listitem>
					<listitem><para>Click <emphasis>Install</emphasis>.</para></listitem>
					<listitem><para>Click <emphasis>Finish</emphasis> to close the installer.</para></listitem>
				</orderedlist>
			</para></listitem>
		</itemizedlist>
		
		<para><emphasis>Net-SNMP</emphasis></para>
		<para><emphasis>Recommended Install Path:</emphasis> <filename>C:\Net-SNMP\</filename></para>
		<Note><para>If PHP 5.2 is not installed, then Net-SNMP should 
		be installed. If you plan to use any hosts with SNMP v3 support, you must install the <application>Net-SNMP</application> binaries, 
		since the PHP SNMP extension does not handle SNMPv3. You do <emphasis>NOT</emphasis> 
		need to install/use the Net-SNMP SNMP agent. The Microsoft SNMP agent is 
		recommended. The Net-SNMP binaries are useful when creating custom 
		scripts, as they provide an easy way to query SNMP data from devices.</para></Note>
		
		<itemizedlist>
			<listitem><para>Run the net-snmp installer</para>
				<orderedlist>
					<listitem><para>At the Welcome page, click <emphasis>Next</emphasis>.</para></listitem>
					<listitem><para>At the license agreement page, select <emphasis>I Agree</emphasis> and 
					click <emphasis>Next</emphasis>.</para></listitem>
					<listitem><para>At the Components page:</para>
						<orderedlist>
						<listitem><para>Check <emphasis>Base Components</emphasis>.</para></listitem>
						<listitem><para>Under Net-SNMP Agent Service, check <emphasis>With Windows 
						Extension DLL support</emphasis>.</para></listitem>
						<listitem><para><emphasis>Uncheck</emphasis> <emphasis>Net-SNMP trap service</emphasis></para></listitem>
						<listitem><para><emphasis>Uncheck</emphasis> <emphasis>Perl SNMP modules</emphasis></para></listitem>
						<listitem><para><emphasis>Uncheck</emphasis> <emphasis>Development files</emphasis></para></listitem>
					</orderedlist>
					</listitem>
					<listitem><para>Click <emphasis>Next</emphasis>.</para></listitem>
					<listitem><para>At the Installation location page, change the destination folder to
					<filename>C:\Net-SNMP\</filename>. Click <emphasis>Next</emphasis>.</para></listitem>
					<listitem><para>At the Start menu folder location page, leave the default and click
					<emphasis>Install</emphasis>.</para></listitem>
					<listitem><para>Once done installing, click <emphasis>Finish</emphasis>.</para></listitem>
				</orderedlist>
			</listitem>
		</itemizedlist>
	</sect1>

	
	<sect1 id="windows_patching"><title>Applying Patches</title> 

		<orderedlist>
			<listitem><para>There are two methods of applying patches to Cacti:</para> 
			<orderedlist numeration=loweralpha>
				<listitem><para>If you have Cygwin installed (installation instructions further down in this guide), 
				then the <ulink url="http://www.cacti.net/download_patches.php">patch instructions</ulink> which use 
				wget and patch, will work.</para></listitem>
				<listitem><para>The other method requires you to visit <ulink url="http://www.cacti.net/downloads/patches/">http://www.cacti.net/downloads/patches/&lt;cacti version&gt;/pre-patched/</ulink> 
				and manually download and replace the patched files.</para></listitem>
			</orderedlist></listitem>
			<listitem><para>You	must reapply file/folder security on the files patched, due to the fact they 
			will not likely inherit the correct permissions. Double check they are correct.</para></listitem>
			<listitem><para>The other method requires you to visit <ulink url="http://www.cacti.net/downloads/patches/">http://www.cacti.net/downloads/patches/&lt;cacti version&gt;/pre-patched/</ulink>
			and manually download and replace the patched files.</para></listitem>
		</orderedlist>
	</sect1>


	<sect1 id="windows_configuration"><title>Configuration</title>

		<para><emphasis>PHP:</emphasis></para>
		<orderedlist>
			<listitem><para>Verify the PHP installer properly added
			<filename>C:\PHP\</filename> to your Windows PATH environment variable. </para>
	
			<orderedlist numeration=upperalpha>
				<listitem><para>The Windows path variable can be accessed via the Control Panel at:System |<guilabel>Advanced</guilabel> | 
				<guilabel>Environment Variables</guilabel></para></listitem>
				<listitem><para>In the System Variables groupbox, find <emphasis>Path</emphasis> and 
				click <emphasis>Edit</emphasis>. Make sure <filename>C:\PHP\</filename> is in there 
				somewhere.</para></listitem>
			</orderedlist></listitem>
				
			<listitem><para>Verify the PHP installer properly added a new system variable called
			<emphasis>PHPRC</emphasis>. Its value should be <filename>C:\PHP\</filename>.</para></listitem>
			<listitem><para>Add a new system variable called <emphasis>MIBDIRS</emphasis>. 
			Its value should be <filename>C:\PHP\Extras\mibs</filename></para>
		
			<orderedlist numeration=upperalpha>
				<listitem><para>Refer to step 1 on the location of the System Variables</para></listitem>
				<listitem><para>Under the System variables groupbox, click on <emphasis>New</emphasis>.</para></listitem>
				<listitem><para>In the Variable name field, type <emphasis>MIBDIRS</emphasis>.</para></listitem>
				<listitem><para>In the Variable value field, type <filename>C:\PHP\Extras\mibs</filename></para></listitem>
				<listitem><para>Click <emphasis>OK</emphasis> and close the dialog boxes.</para></listitem>
			</orderedlist></listitem>
			
			<listitem><para>Uncomment/modify the following lines in <filename>C:\PHP\php.ini</filename>.</para>
			<screen><userinput>register_argc_argv = On
safe_mode = Off
cgi.force_redirect = 0
upload_tmp_dir = &quot;C:\PHP\Uploadtemp&quot;
session.save_path=&quot;C:\PHP\Session&quot;</userinput></screen></listitem>

			<listitem><para>The	following resource limits should be changed from their defaults. 
			Depending on the scripts, amount of data being returned and number of devices you use, they might need to 
			be further increased at a later period in time.</para>
			<screen><userinput>max_execution_time = 60 ; Maximum execution time of each script, in seconds
max_input_time = 120 ; Maximum amount of time each script may spend parsing request data
memory_limit = 64M ; Maximum amount of memory a script may consume (8MB)</userinput></screen></listitem>

			<listitem><para>If you have had previous versions of PHP installed, you had likely moved the PHP system files to in the Windows directory structure. If so, you will have to remove those files. Please review your PHP installation documentation for instructions on removing those files.</para></listitem>
			<listitem><para>Change NTFS permissions on <filename>C:\PHP\Uploadtemp</filename> 
			and <filename>C:\PHP\Session</filename> to grant <emphasis>Modify</emphasis> 
			rights to the <emphasis>IUSR_</emphasis> and <emphasis>IIS_WPG</emphasis> users 
			for only files in the directory.</para></listitem>

			<listitem><para>Give the user who will be running the scheduled task,
			<emphasis>Modify</emphasis> rights to:
			<filename>c:\php\extras\mibs\.index</filename></para></listitem>
		</orderedlist>

		<para><emphasis>IIS:</emphasis></para>
		<Note><para>Only IIS6 and later has the IIS_WPG user account.</para></Note>
		<orderedlist>
			<listitem><para>Start the Internet Information Services (IIS) Manager, right click on 
			<emphasis>Default Web Site</emphasis> and select <emphasis>Properties</emphasis>.</para></listitem>
		
			<listitem><para>Under the <emphasis>ISAPI Filters</emphasis> tab: </para>
			<orderedlist numeration=upperalpha>
				<listitem><para>Click on <emphasis>Add</emphasis>. </para></listitem>
				<listitem><para>In the Filter Name field, type: <emphasis>.php</emphasis>.</para></listitem>
				<listitem><para>In the Executable field, click on <emphasis>Browse...</emphasis> </para></listitem>
				<listitem><para>Navigate to <filename>C:\PHP\php5isapi.dll</filename>.</para></listitem>
				<listitem><para>Click <emphasis>OK</emphasis>.</para></listitem>
			</orderedlist></listitem>
			
			<listitem><para>Under the <emphasis>Home Directory</emphasis> tab:</para>
			<orderedlist numeration=upperalpha>
				<listitem><para>Verify the PHP installer created a mapping for the <emphasis>.PHP 
				extension</emphasis> to <filename>C:\PHP\php5isapi.dll</filename>.</para></listitem>
				<listitem><para>Verify the .PHP mapping has <emphasis>All Verbs</emphasis> and <emphasis>
				Script Engine</emphasis> checked.</para></listitem>
			</orderedlist></listitem>
			
			<listitem><para>Under the <emphasis>Documents</emphasis> tab, add <filename>index.php</filename> to the list.</para></listitem>
			
			<listitem><para>Click <emphasis>OK</emphasis> to close the Default Website Properties window.</para></listitem>
			<listitem><para>If using IIS6, go to<guilabel>Web Service Extensions</guilabel> and add a new <guilabel>Web Service Extension</guilabel>. 
			Name the extension <emphasis>php</emphasis>, click <guilabel>Add</guilabel> 
			and browse to <filename>C:\PHP\php5isapi.dll</filename>, enable <guilabel>Set Extension status to Enable</guilabel>, and click 
			<emphasis>OK</emphasis>.</para></listitem>
			
			<listitem><para>Under the <emphasis>Default Web Site</emphasis>, right click on 
			<emphasis>Cacti</emphasis> folder and select <emphasis>Properties</emphasis>.</para>
			
			<orderedlist numeration=upperalpha>
				<listitem><para>Click on the <emphasis>Documents</emphasis> tab</para></listitem>
				<listitem><para>Click on <emphasis>Add...</emphasis>.</para></listitem>
				<listitem><para>In the Default Document Name field, type in: <emphasis>index.php</emphasis> 
				and click <emphasis>OK</emphasis>.</para></listitem>
				<listitem><para>Select<emphasis> index.php</emphasis> in the default document list 
				and move it to the top.</para></listitem>
				<listitem><para>Click <emphasis>OK</emphasis> to close the cacti properties window.</para></listitem>
			</orderedlist></listitem>
		
			<listitem><para>Give the <emphasis>COMPUTERNAME\IUSR_</emphasis> and <emphasis>COMPUTERNAME\IIS_WPG</emphasis> users 
			<emphasis>Read &amp; Execute</emphasis> permissions to the file 
			<filename>C:\Windows\system32\cmd.exe</filename>.
			Yes, this can be a large security hole, but it&#39;s required so RRDTool can be launched for graphing by 
			the anonymous web account. For slightly improved security, one can 
			specify a separate custom User account which would be used for the /wwwroot/Cacti/ 
			site. Then, instead of using <emphasis>IUSR_</emphasis> everywhere throughout this 
			document, replace it with the custom User account. This way, only a 
			security hole in Cacti&#39;s code could exploit <filename>cmd.exe</filename> and not all sites on the 
			IIS server.</para>
			
			<orderedlist numeration=upperalpha>
				<listitem><para>Right click on <filename>cmd.exe</filename> and select
				<emphasis>Properties</emphasis>.</para></listitem>
				<listitem><para>Click on the <emphasis>Security</emphasis> tab.</para></listitem>
				<listitem><para>Select the <emphasis>IUSR_</emphasis> account</para></listitem>
				<listitem><para>Click on <emphasis>Read &amp; Execute</emphasis> in the Permissions box.</para></listitem>
				<listitem><para>Repeat for the IIS_WPG user.</para></listitem>
				<listitem><para>Click <emphasis>OK</emphasis>.</para></listitem>
			</orderedlist></listitem>
			
			<listitem><para>Both <emphasis>IUSR_</emphasis> and <emphasis>IIS_WPG</emphasis> users will also need read permissions on 
			<filename>C:\Inetpub\wwwroot\cacti\</filename>and its subfolders.</para>
			
			<orderedlist numeration=upperalpha>
				<listitem><para>Right click on the folder <filename>C:\Inetpub\wwwroot\cacti</filename> 
				and select <emphasis>Properties</emphasis>.</para></listitem>
				<listitem><para>Click on the <emphasis>Security</emphasis> tab.</para></listitem>
				<listitem><para>Click on <emphasis>Add...</emphasis> under the group or user names 
				section.</para></listitem>
				<listitem><para>Type in <emphasis>IUSR_</emphasis>COMPUTERNAME or click Advanced... 
				and Find Now. Repeat for the IIS_WPG account.</para></listitem>
				<listitem><para>Click <emphasis>OK</emphasis> to close the select users or groups 
				window.</para></listitem>
				<listitem><para>Select the <emphasis>IUSR_</emphasis>COMPUTERNAME from the list.</para></listitem>
				<listitem><para>Select <emphasis>Read &amp; Execute</emphasis> from the Permissions box.</para></listitem>
				<listitem><para>Repeat for the IIS_WPG account.</para></listitem>
				<listitem><para>At the bottom of the Security tab, click on <emphasis>Advanced...</emphasis>.</para></listitem>
				<listitem><para>In the Permissions tab, click on <emphasis>Replace permissions 
				entries on all child objects with entries shown here that apply to 
				child objects</emphasis>.</para></listitem>
				<listitem><para>Click <emphasis>OK</emphasis>. </para></listitem>
				<listitem><para>Click <emphasis>Yes</emphasis> to the Security warning dialog box.</para></listitem>
				<listitem><para>Click <emphasis>OK</emphasis> to close the properties window.</para></listitem>
			</orderedlist></listitem>
			
			<listitem><para>Give the <emphasis>IUSR_</emphasis> and <emphasis>IIS_WPG</emphasis> users <emphasis>modify</emphasis> permissions to the folders 
			<filename>C:\Inetpub\wwwroot\cacti\log</filename> and <filename>C:\Inetpub\wwwroot\cacti\rra</filename>.</para></listitem>
			<listitem><para>Completely stop and start the IIS service using the following commands 
			from the command prompt. Alternatively, use the Service MMC 
			snap-in under Administrative Tools.</para>
	
			<screen><userinput>net stop iisadmin
net start w3svc</userinput></screen></listitem>

			<listitem><para>Verify PHP is functional by running: <userinput>php -m</userinput> 
			at the command prompt.</para> 
			
			<Note><para>If messages with, <emphasis>Cannot find module</emphasis> appearing, then there is 
			something wrong with the MIBDIRS variable or missing mib files in the 
			PHP\Extras\mib folder. Make sure the MySQL, SNMP and Sockets PHP 
			modules are in the list.</para></Note>
			<screen><prompt>c:\&gt;</prompt> <userinput>php -m
[PHP Modules]
bcmath
calendar
com_dotnet
ctype
date
dom
filter
ftp
hash
iconv
json
libxml
mssql
mysql				<-- required
odbc
pcre
Reflection
session
SimpleXML
snmp				<-- required
sockets				<-- required
SPL
standard
tokenizer
wddx
xml
xmlreader
xmlwriter
zlib

[Zend Modules]</userinput></screen></listitem>
		</orderedlist>


	<para><emphasis>RRDTool</emphasis></para>
	<orderedlist>
		<listitem><para>If you plan on installing Cygwin,remove 
		all DLL filesfrom the <filename>C:\rrdtool</filename> directory. Otherwise, 
		nothing to configure.</para></listitem>
	</orderedlist>

	<para><emphasis>MySQL</emphasis></para>
	<orderedlist>
		<listitem><para>Stop the MySQL service.</para></listitem>
		<listitem><para>Edit your <filename>C:\MySQL\my.ini</filename> file</para></listitem>
		<listitem><para>Verify you don't have a <emphasis>sql-mode </emphasis>defined. If so, 
		comment it out.</para></listitem>
		<listitem><para>You will need to apply the <ulink url="http://dev.mysql.com/doc/mysql/en/old-client.html">old client</ulink> hack for user authentication to work with Cacti.</para> 
			<orderedlist numeration=upperalpha>
				<listitem><para>Add the following to the [mysqld] sub-section:
				<screen>#Use old password encryption method (needed for 4.0 and older clients).
old-passwords</screen></para></listitem>
			</orderedlist></listitem>
		<listitem><para>Start the MySQL service.</para></listitem>
		<listitem><para>Set a password for the root user (if not set already during MySQL installation) </para>
	    <screen><prompt>c:\&gt;</prompt> <userinput>mysqladmin --user=root password somepassword</userinput>
<prompt>c:\&gt;</prompt> <userinput>mysqladmin --user=root --password reload</userinput></screen></listitem>
		<listitem><para>Create the MySQL database:</para>
		<screen><prompt>c:\&gt;</prompt> <userinput>mysqladmin --user=root --password create cacti</userinput></screen></listitem>
		<listitem><para>Import the default Cacti database:</para>
		<screen><prompt>c:\&gt;</prompt> <userinput>mysql --user=root --password cacti &lt; c:\inetpub\wwwroot\cacti\cacti.sql</userinput></screen>
		<Note><para>If you get any errors during this 
		phase, you likely have sql-strict mode enabled or something else 
		misconfigured in my.ini!</para></Note></listitem> 
		<listitem><para>Create a MySQL username and password for Cacti.</para>
		<screen><prompt>c:\&gt;</prompt> <userinput>mysql --user=root --password mysql</userinput>
<prompt>mysql&gt;</prompt> <userinput>GRANT ALL ON cacti.* TO cactiuser@localhost IDENTIFIED BY 'cactipw';</userinput>
<prompt>mysql&gt;</prompt> <userinput>flush privileges;</userinput></screen></listitem>

		<listitem><para>You will also need to update the cactiuser account with the old password style:</para>
		<screen><prompt>mysql&gt;</prompt> <userinput>UPDATE mysql.user SET Password = OLD_PASSWORD('cactipw') WHERE Host = 'localhost' AND User = 'cactiuser';</userinput>
<prompt>mysql&gt;</prompt> <userinput>FLUSH PRIVILEGES;</userinput>
<prompt>mysql&gt;</prompt> <userinput>exit</userinput></screen></listitem>
	</orderedlist>

	<para><emphasis>Cacti</emphasis></para>
	<orderedlist>
		<listitem><para>Reboot your server. Some times environment variables and services need to be reset in order for everything to work properly.</para></listitem>
		<listitem><para>Edit <filename>c:\inetpub\wwwroot\cacti\include\config.php</filename> and specify the MySQL user, password and database for your Cacti configuration.</para>
		<screen><userinput>$database_default = "cacti";
$database_hostname = "localhost";
$database_username = "cactiuser";
$database_password = "cactipw";</userinput></screen></listitem>
		<listitem><para>Point your web browser to <ulink url="http://localhost/cacti/">http://localhost/cacti/</ulink>
		You should be presented with the <emphasis>Cacti Installation Guide</emphasis> 
		page.</para></listitem>
		<listitem><para>Click <emphasis>Next</emphasis>.</para></listitem>
		<listitem><para>Select <emphasis>New Install</emphasis> for the type of installation. 
		Click <emphasis>Next</emphasis>.</para></listitem>
		<listitem><para>Verify the RRDTool, PHP, Cacti Log File, paths and RRDTool Utility 
		version are all correct. Ignore the Net-SNMP paths unless it was 
		previously installed. Click <emphasis>Finish</emphasis>.</para></listitem>
		<listitem><para>At the User Login page,
		log in the with a username of <emphasis>admin</emphasis> and password of 
		<emphasis>admin</emphasis>. You will be required to change this password immediately.</para>
		<Note><para>If you are brought back to the User Login
		page with no error messages, then you have have a PHP session/cookie 
		problem.</para></Note></listitem>
		<listitem><para>Once logged in, click on <guilabel>Settings</guilabel> 
		and then the <guilabel>Paths</guilabel> tab. Verify/update your paths to point to the correct locations. Recommended examples are posted below. If you plan on using 
		Spine in the future, then it is very important that your all your paths and scripts use forward slashes.
		Additionally, RRDTool 1.0 used a mono-spaced font while RRDTool 1.2 defaults to variable width font. Using the latter will cause graph text to not align properly. That being the case, a solution is to specify a mono-spaced font like VeraMono or DejaVuSansMono-Roman 
		in the RRDTool Default Font Path (i.e. <filename>C:/windows/fonts/VeraMono.ttf</filename>). 
		Google for these fonts, as they don&#39;t come with Windows.</para>

		<para><emphasis>PHP Binary Path:</emphasis></para>
		<screen><userinput>c:/php/php.exe</userinput></screen>
		<para><emphasis>RRDTool Binary Path:</emphasis></para>
		<screen><userinput>c:/rrdtool/rrdtool.exe</userinput></screen>
		<para><emphasis>RRDTool Default Font Path:</emphasis></para>
		<screen><userinput>c:/windows/fonts/arial.ttf</userinput></screen>
		<para><emphasis>RRDTool Version:</emphasis></para>
		<screen><userinput>Select the appropriate version</userinput></screen>
		<para><emphasis>SNMPGET, SNMPWALK, SNMPBULKWALK, SNMPGETNEXT Paths:</emphasis></para>
		<screen><userinput>c:/net-snmp/bin/snmpget.exe
c:/net-snmp/bin/snmpwalk.exe
c:/net-snmp/bin/snmpbulkwalk.exe
c:/net-snmp/bin/snmpgetnext.exe</userinput></screen>
		<para><emphasis>Cacti Logfile Path:</emphasis></para>
		<screen><userinput>c:/inetpub/wwwroot/cacti/log/cacti.log</userinput></screen>
		<para><emphasis>Spine Path:</emphasis></para>
		<screen><userinput>c:/Spine/Spine.exe</userinput></screen></listitem>

		<listitem><para>Click on <guibutton>Devices</guibutton>. Delete Localhost, since it's set up to use the Linux host template. </para></listitem>
		<listitem><para>In the upper right corner, click on <guibutton>Add</guibutton>.  Fill in the following information and then click 
		<guibutton>Add</guibutton>.</para>

		<screen><userinput>Description: localhost
Hostname: localhost
Host Template: Windows 2000/XP</userinput></screen></listitem>

		<listitem><para>You should now be looking at the localhost device screen. Right under it's name, there should be some SNMP 
		Information listed regarding the system, uptime, hostname, location and	contact. 
		If not, you should double check the SNMP settings on the server and firewall settings. In the upper right-hand corner, click on
		<guibutton>Create Graphs for this Host</guibutton>. </para></listitem>
		<listitem><para>On the following screen, select a disk partition and network interface. At the bottom of the page, click on
		<guibutton>Create</guibutton>.</para></listitem>
		<listitem><para>Log into the user account you'll be using for the scheduled task andverify starting a Cacti polling cycle works. Do this by running the following from the command prompt:</para>
		<screen><userinput>php c:\inetpub\wwwroot\cacti\poller.php</userinput></screen>
		<para>The output should look something like this:</para>
		<screen><prompt>C:\&gt;</prompt> <userinput>php c:\inetpub\wwwroot\cacti\poller.php</userinput>
OK u:0.00 s:0.06 r:1.32
OK u:0.00 s:0.06 r:1.32
OK u:0.00 s:0.16 r:2.59
OK u:0.00 s:0.17 r:2.62
10/28/2005 04:57:12 PM - SYSTEM STATS: Time:4.7272 Method:cmd.php Processes:1 Threads:N/A Hosts:1 HostsPerProcess:2 DataSources:4 RRDsProcessed:2</screen>

		<para>After this has ran once, you should have <filename>cacti.log</filename>in 
		<filename>/cacti/log/</filename>and rrd files in
		<filename>/cacti/rra/</filename>.</para></listitem>
		<listitem><para>You are going to need to schedule a task while logged on as an Administrator account, so 
		<filename>poller.php</filename> can run every 5 minutes. Make sure the Task Scheduler service is started and follow the steps below to begin.</para>

		<orderedlist numeration=upperalpha>
			<listitem><para>Select <guilabel>Start</guilabel> --&gt; 
			<guilabel>Settings</guilabel> --&gt; <guilabel>Control Panel</guilabel> and double click on 
			<guilabel>Scheduled Tasks</guilabel>.</para></listitem>
			<listitem><para>Double click on <guilabel>Add Scheduled Task</guilabel>.</para></listitem>
			<listitem><para>Click <guilabel>Next</guilabel> and 
			<guilabel>Browse</guilabel> on the following screen. Find 
			<filename>c:\php</filename> and select <filename>php.exe</filename>. Choose
			<guilabel>Daily</guilabel> on and click 
			<guilabel>Next</guilabel>.</para></listitem>
			<listitem><para>Click <guilabel>Next</guilabel> again without changing the time or date settings.</para></listitem>
			<listitem><para>When entering a username and password make sure the user has 
			<emphasis>modify</emphasis> permissions to the following directories:</para>

			<screen><userinput>c:\inetpub\wwwroot\cacti\rra\
c:\inetpub\wwwroot\cacti\log\</userinput></screen>
			<para>Make sure the user has <emphasis>Read&amp; Execute</emphasis> 
			permissions to the following directories:</para>
			
			<screen><userinput>c:\php\
c:\inetpub\wwwroot\cacti\
c:\rrdtool\</userinput></screen></listitem>

			<listitem><para>Click <guilabel>Next</guilabel> and 
			<guilabel>Finish</guilabel> to close the wizard.</para></listitem>
			<listitem><para>Right click on the task you just created, and select 
			<guilabel>Properties</guilabel>.</para></listitem>
			<listitem><para>Select the <guilabel>Schedule</guilabel> tab.</para></listitem>
			<listitem><para>Make sure <guilabel>Daily</guilabel> is selected and click the 
			<guilabel>Advanced</guilabel> button.</para></listitem>
			<listitem><para>Check the <guilabel>Repeat</guilabel> checkbox, set the repetition for every 5 minutes,set the durationfor 24 hours, and check 
			the <guilabel>If the task is still running, stop it at this time</guilabel> checkbox.</para></listitem>
			<listitem><para>Click <guilabel>OK</guilabel></para></listitem>
			<listitem><para>In the <guilabel>Run</guilabel> textbox enter the following text making sure to use the appropriate paths.</para>
			
			<screen><userinput>c:\php\php.exe c:\inetpub\wwwroot\cacti\poller.php</userinput></screen>
			<para>The start in box should say <filename>c:\inetpub\wwwroot\cacti</filename>.</para></listitem>
		</orderedlist></listitem>
		
		<listitem><para>After waiting 10 minutes (aka 2 polling cycles), one should be able 
		to view the graphs.</para></listitem>
		<listitem><para>Go to <guilabel>Graph Management</guilabel> and click on 
		each graph to view its progress.</para></listitem>
		<listitem><para>Go to <guilabel>Graph Trees</guilabel> and click on
		<guilabel>Default Tree</guilabel>.</para></listitem>
		<listitem><para>Click on <guilabel>Add</guilabel>.</para></listitem>
		<listitem><para>Under <guilabel>Tree Item Type,</guilabel> select <emphasis>Host</emphasis>. 
		Click on <guilabel>Create</guilabel> and then <guilabel>Save</guilabel>.</para></listitem>
		<listitem><para>View the new graph tree by clicking on the <guilabel>Graphs</guilabel> tab
		at the top of the screen.</para></listitem>
	</orderedlist>
	</sect1>


	<sect1 id="windows_config_optional"><title>Configuration - Optional Components</title>
	<para><emphasis>Apache:</emphasis></para>
	<orderedlist>
		<listitem><para>Add the following lines to your <filename>httpd.conf</filename> file in the <filename>c:\apache2\conf</filename> directory:</para>
    
<screen><userinput>LoadModule php5_module &quot;c:/php/php5apache2_2.dll&quot;
AddType application/x-httpd-php .php
PHPIniDir &quot;C:/php&quot;
DirectoryIndex index.php index.html index.htm</userinput></screen></listitem>
		<listitem><para>Restart the Apache service.</para></listitem>
	</orderedlist>


	<para><emphasis>Net-SNMP</emphasis></para>
	<orderedlist>
		<listitem><para>Append the <emphasis>MIBDIRS</emphasis> system variable with the path of 
		Net-SNMP MIB files.</para>
		<screen><userinput>MIBDIRS=c:\php\extras\mibs;C:\Net-SNMP\share\snmp\mibs</userinput></screen></listitem>
	</orderedlist>
	
	
	<para><emphasis>Spine</emphasis></para>
	<orderedlist>
		<listitem><para>Modify the <filename>Spine.conf</filename> file in <filename>c:\Spine</filename> to include the following statements.</para>
	
		<screen>DB_Host      	IP Address or Hostname (not localhost)
DB_Database	cacti
DB_User      	cactiuser
DB_Password 	cactipw
DB_Port     	3306</screen></listitem>

		<listitem><para>If you have <application>Cygwin</application> installed, remove the DLL files from the <filename>c:\Spine</filename> directory.</para></listitem>
	</orderedlist>
	</sect1>


	<sect1 id="windows_troubleshooting"><title>Troubleshooting:</title>
	
	<orderedlist>
		<listitem><para>If you're not getting any graphs or rrd files created, it's possibly because Cacti is not 
		collecting valid data. You must wait at least two polling cycles for data to show up in a graph. 
		To check if Cacti is collecting valid data from your device in question, do the following:</para> 
		
		<orderedlist>
			<listitem><para>Turn the <guilabel>Poller Logging Level</guilabel> in Cacti to debug 
			(Settings | Polling level) for one cycle, wait for Cacti to run</para></listitem>
			<listitem><para>This is an example of a successful SNMP query:</para> 
			<screen>CMDPHP: Poller[0] Host[2] DS[18] SNMP: v1: 192.168.100.1, dsname: traffic_out, oid: .1.3.6.1.2.1.2.2.1.16.1, output: 322328722
CMDPHP: Poller[0] Host[2] DS[18] SNMP: v1: 192.168.100.1, dsname: traffic_in, oid: .1.3.6.1.2.1.2.2.1.10.1, output: 426701050</screen>

		<para>If the output was NaN, then Cacti did not collect any data. This is where either the 
		Net-SNMP tools or <ulink url="http://www.wtcs.org/snmp4tpc/getif.htm">GetIF</ulink> comes in 
		handy for testing SNMP.</para>
			<orderedlist numeration=lowerroman>
				<listitem><para>Test if you're able to retrieve SNMP data manually using the OID Cacti failed on. You might need to remove the last number from the OID when doing this. For example, in the case of retrieving interface data, instead of using .1.3.6.1.2.1.2.2.1.10.1 in the example above, you should snmpwalk .1.3.6.1.2.1.2.2.1. Using Net-SNMP snmpwalk, you would do:
				<screen><userinput>C:\net-snmp\bin&gt;snmpwalk -v 1 -c public 192.168.2.1 .1.3.6.1.2.1.2.2.1</userinput></screen></para></listitem>
				<listitem><para>If you still receive no SNMP output, then you either didn't properly configure the SNMP agent or there is a firewall blocking the data.</para></listitem>
			</orderedlist></listitem>
			<listitem><para>Another thing you'll want to look for in the log file are CACTI2RRD entries. These are when Cacti updates the rrd files with the data it collected during a polling cycle. Here is an example of one from my traffic collected from above:
			<screen><userinput>POLLER: Poller[0] CACTI2RRD: c:/rrdtool/rrdtool.exe update C:\inetpub\wwwroot\cacti\rra\cable_modem_traffic_1.rrd --template traffic_out:traffic_in 1141333802:322328722:426701050</userinput></screen></para></listitem><listitem><para>If you saw in the log file Cacti updating the rrd file, but the modification date never changed on the rrd file, then you have a permission problem somewhere. Check the IUSR and IIS_WPG user accounts have read/execute rights on rrdtool.exe and cmd.exe. They'll also need modfiy rights to the <filename>/cacti/rra</filename> and 
			<filename>/cacti/log</filename> folders. </para></listitem>

			<listitem><para>Follow <ulink url="http://docs.cacti.net/node/283">this guide</ulink> on 
			debugging NaN&#39;s.</para></listitem>
		</orderedlist></listitem>
	</orderedlist>
	</sect1>

	<sect1 id="windows_optimizations"><title>Optimizations:</title>
	<para>There are several things you can do to speed up your Cacti web server. It's suggested that you only apply these 
	<emphasis>after</emphasis> you have a fully functional Cacti installation. </para>
	<orderedlist>
		<listitem><para>Switch the polling agent in Cacti from cmd.php to 
		Spine.exe. Go to <guilabel>Settings</guilabel> 
		<guibutton>Poller</guibutton> | <guilabel>Type</guilabel>. 
		Don't forget to configure your <filename>C:\Spine\Spine.conf</filename> file.</para></listitem>
		<listitem><para>Install the <ulink url="http://www.zend.com/store/products/zend-optimizer.php">Zend Optimizer</ulink> for PHP.</para></listitem>
		<listitem><para>Set up the query cache in MySQL. Read about how to properly <ulink url="http://dev.mysql.com/doc/refman/4.1/en/query-cache-configuration.html">configure the settings</ulink>. 
		You will need to stop the MySQL service when you edit <filename>c:\mysql\my.ini</filename> and put in the following:</para>
		<screen>#The memory allocated to store results from old queries.
query_cache_size=16M
#Don't cache results that are bigger than this.
query_cache_limit=1M
#Query cache type to use.
query_cache_type=1</screen></listitem>
		<listitem><para>Install <ulink url="http://www.fastcgi.com/">FastCGI</ulink>, which can offer 
		<ulink url="http://phplens.com/phpeverywhere/node/view/13">x4 to x8 improvement</ulink> 
		(for IIS users at least).</para></listitem>
		<listitem><para>An extensive list of other optimizations for PHP and MySQL can be found over at 
		<ulink url="http://phplens.com/lens/php-book/optimizing-debugging-php.php">phplens.com</ulink>.</para></listitem>
		<listitem><para>Install the Cacti
		<ulink url="http://cactiusers.org/wiki/PluginArchitectureInstall">plugin architecture</ulink> and 
		<ulink url="http://forums.cacti.net/viewtopic.php?t=18430">Boost plugin</ulink>.</para></listitem>
	</orderedlist>
	</sect1>
	</chapter>
	<chapter id="upgrade">
		<title>Upgrading Cacti</title>
		<orderedlist>
			<listitem>
				<para>
					Backup the old Cacti database.
				</para>
				<screen><prompt>shell&gt;</prompt> <userinput>mysqldump -l --add-drop-table cacti &gt; mysql.cacti</userinput></screen>
				<para>
					Note: You will probably have to specify the -u and -p flags for the MySQL username and password. This user
					must have permission to read from Cacti's database or you will end up with an empty backup.
				</para>
			</listitem>
			<listitem>
				<para>
					Backup the old Cacti directory.
				</para>
				<screen><prompt>shell&gt;</prompt> <userinput>mv cacti cacti_old</userinput></screen>
			</listitem>
			<listitem>
				<para>
					Extract the distribution tarball.
				</para>
				<screen><prompt>shell&gt;</prompt> <userinput>tar xzvf cacti-version.tar.gz</userinput></screen>
			</listitem>
			<listitem>
				<para>
					Rename the new Cacti directory to match the old one.
				</para>
				<screen><prompt>shell&gt;</prompt> <userinput>mv cacti-version cacti</userinput></screen>
			</listitem>
			<listitem>
				<para>
					Edit <filename>include/config.php</filename> and specify the MySQL user, password and database for your Cacti configuration.
				</para>
				<screen><userinput>$database_type = "mysql";
$database_default = "cacti";
$database_hostname = "localhost";
$database_username = "cactiuser";
$database_password = "cacti";</userinput></screen>
			</listitem>
			<listitem>
				<para>
					Copy the *.rrd files from the old Cacti directory.
				</para>
				<screen><prompt>shell&gt;</prompt> <userinput>cp cacti_old/rra/* cacti/rra/</userinput></screen>
			</listitem>
			<listitem>
				<para>
					Copy any relevant custom scripts from the old Cacti directory.  Some script are updated between versions.  Therefore, make sure you only over write if the scripts either don't exist or are newer than the distribution's.
				</para>
				<screen><prompt>shell&gt;</prompt> <userinput>cp -u cacti_old/scripts/* cacti/scripts/</userinput></screen>
			</listitem>
			<listitem>
				<para>
					Copy any relevant custom resource XML files from the old Cacti directory.  Some resource XML files are updated between versions.  Therefore, make sure you only over write if the XML files either don't exist or are newer than the distribution's.
				</para>
				<screen><prompt>shell&gt;</prompt> <userinput>cp -u -R cacti_old/resource/* cacti/resource/</userinput></screen>
			</listitem>

			<listitem>
				<para>
					Set the appropriate permissions on Cacti's directories for graph/log generation. You
					should execute these commands from inside Cacti's directory to change the permissions.
				</para>
				<screen><prompt>shell&gt;</prompt> <userinput>chown -R cactiuser rra/ log/</userinput></screen>
				<para>
					(Enter a valid username for cactiuser, this user will also be used in the next step for data
					gathering.)
				</para>
			</listitem>
			<listitem>
				<para>
					Point your web browser to:
				</para>
				<blockquote>
					<para>
						http://your-server/cacti/
					</para>
				</blockquote>
				<para>
					Follow the on-screen instructions so your database can be updated to the new version.
				</para>
			</listitem>
		</orderedlist>
	</chapter>
</part>
